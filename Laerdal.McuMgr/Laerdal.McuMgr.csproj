<Project Sdk="Xamarin.Legacy.Sdk/0.2.0-alpha4">

    <!-- SHARED -->
    <PropertyGroup>
        <IsOSX>$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::OSX)))</IsOSX>
        <IsLinux>$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::Linux)))</IsLinux>
        <IsWindows>$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::Windows)))</IsWindows>
        <IsUnix Condition=" '$(IsOSX)' == 'True' OR '$(IsLinux)' == 'True' ">True</IsUnix>

        <!-- it only makes sense to build ios stuff under osx because xcodebuild is only available there -->
        <TargetFrameworks>$(TargetFrameworks)netstandard2.0;</TargetFrameworks>
        <TargetFrameworks>$(TargetFrameworks)monoandroid12.0;</TargetFrameworks>
        <TargetFrameworks Condition=" '$(IsOSX)' == 'True' ">$(TargetFrameworks)xamarin.ios10;</TargetFrameworks>

        <TargetFrameworks>$(TargetFrameworks)net6.0-android;</TargetFrameworks>
        <TargetFrameworks>$(TargetFrameworks)net7.0-android;</TargetFrameworks>
        <TargetFrameworks Condition=" '$(IsOSX)' == 'True' ">$(TargetFrameworks)net6.0-ios10.0;</TargetFrameworks>

        <IsCompilingForNet6 Condition="                  $(TargetFramework.ToLower().StartsWith('net6.'))          ">true</IsCompilingForNet6>
        <IsCompilingForNet6IOS Condition="               $(TargetFramework.ToLower().StartsWith('net6.0-ios'))     ">true</IsCompilingForNet6IOS>
        <IsCompilingForNet6Android Condition="           $(TargetFramework.ToLower().StartsWith('net6.0-android')) ">true</IsCompilingForNet6Android>
        <IsCompilingForNet7Android Condition="           $(TargetFramework.ToLower().StartsWith('net7.0-android')) ">true</IsCompilingForNet7Android>
        <IsCompilingForNetXAndroid Condition="           '$(IsCompilingForNet6Android)' == 'true' OR '$(IsCompilingForNet7Android)' == 'true' ">true</IsCompilingForNetXAndroid>
        <IsCompilingForNetStandard Condition="           $(TargetFramework.ToLower().StartsWith('netstandard'))    ">true</IsCompilingForNetStandard>
        <IsCompilingForClassicXamarinIOS Condition="     $(TargetFramework.ToLower().StartsWith('xamarin.ios'))    ">true</IsCompilingForClassicXamarinIOS>
        <IsCompilingForClassicXamarinAndroid Condition=" $(TargetFramework.ToLower().StartsWith('monoandroid'))    ">true</IsCompilingForClassicXamarinAndroid>

        <IsCompilingForIOS Condition="     '$(IsCompilingForClassicXamarinIOS)'     == 'true' OR '$(IsCompilingForNet6IOS)'     == 'true' ">true</IsCompilingForIOS>
        <IsCompilingForAndroid Condition=" '$(IsCompilingForClassicXamarinAndroid)' == 'true' OR '$(IsCompilingForNetXAndroid)' == 'true' ">true</IsCompilingForAndroid>
        
        <OutputType>Library</OutputType>
        <OutputPath>bin\</OutputPath>
        <LangVersion>9</LangVersion>
        <DebugSymbols>true</DebugSymbols>
        <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
    </PropertyGroup>

    <PropertyGroup>
        <PackageId>Laerdal.McuMgr</PackageId>
        <PackageTags>Xamarin;McuMgr;Dfu;Ble</PackageTags>
        <PackageDescription>Xamarin managed wrapper around 'Laerdal.McuMgr.Bindings.*' for iOS, Android and NetStandard.</PackageDescription>
        <PackageProjectUrl>https://github.com/Laerdal/xamarin-nordic-mcumgr</PackageProjectUrl>

        <PackageOutputPath Condition=" '$(PackageOutputPath)' == '' ">../Artifacts</PackageOutputPath>
        <PackageIcon Condition="Exists('icon.png')">icon.png</PackageIcon>
        <PackageLicenseFile>LICENSE</PackageLicenseFile>

        <!-- package dependencies are being intelligently added automatically to the nuspec so no need to be explicit about it here -->
        <!-- <PackageReference Include="Laerdal.McuMgr.Core" Version="1.1.0" /> -->

        <GeneratePackageOnBuild>true</GeneratePackageOnBuild>
        <SymbolPackageFormat>snupkg</SymbolPackageFormat>

        <!-- sourcelink: Include PDB in the built .nupkg -->
        <AllowedOutputExtensionsInPackageBuildOutputFolder>$(AllowedOutputExtensionsInPackageBuildOutputFolder);.pdb</AllowedOutputExtensionsInPackageBuildOutputFolder>

        <!-- these versions are getting replaced by the build script in one swift pass -->
        <Version>1.0.736.0</Version>
        <FileVersion>1.0.736.0</FileVersion>
        <PackageVersion>1.0.736.0</PackageVersion>
        <AssemblyVersion>1.0.736.0</AssemblyVersion>

        <Title>$(PackageId)</Title>
        <Summary>Xamarin McuMgr Managed-Wrapper Library</Summary>
        <Description>$(PackageDescription)</Description>
        <Authors>François Raminosona, Kyriakos Sidiropoulos, Laerdal</Authors>
        <Owners>$(Authors)</Owners>
        <Copyright>$(Authors)</Copyright>
        <PackageProjectUrl>https://github.com/Laerdal/xamarin-nordic-mcumgr.git</PackageProjectUrl>
        <PublishRepositoryUrl>true</PublishRepositoryUrl>
        <RepositoryType>git</RepositoryType>

        <IncludeSource>True</IncludeSource>
        <IncludeSymbols>True</IncludeSymbols>

        <!-- see : https://cezarypiatek.github.io/post/managing-output-in-sdk-projects/ -->
        <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>

        <!-- sourcelink: Embed source files that are not tracked by the source control manager to the PDB -->
        <EmbedUntrackedSources>true</EmbedUntrackedSources>

        <!-- warning MSB9004: ManifestResourceWithNoCulture item type is deprecated. Emit EmbeddedResource items instead, with metadata WithCulture='false', Type='Resx', and optional LogicalName. -->
        <MSBuildWarningsAsMessages>$(MSBuildWarningsAsMessages);MSB9004</MSBuildWarningsAsMessages>

        <!-- WARN : SecureDFUServiceInitiator.g.cs: [CS0114] 'SecureDFUServiceInitiator.StartWithTargetWithIdentifier(NSUuid)' hides inherited member        -->
        <!-- 'DFUServiceInitiator.StartWithTargetWithIdentifier(NSUuid)'. To make the current member override that implementation, add the override keyword. -->
        <!-- Otherwise add the new keyword. Can be ignored.                                                                                                  -->
        <NoWarn>CS0114;CS0618;CS0108;NETSDK1202;</NoWarn>
    </PropertyGroup>

    <ItemGroup>
        <None Include="icon.png" Pack="true" PackagePath="\" Condition="Exists('icon.png')"/>
        <None Include="../LICENSE" Pack="true" PackagePath="\"/>
        <None Remove="Laerdal.McuMgr.csproj.DotSettings"/>
    </ItemGroup>

    <!-- SHARED -->
    <ItemGroup>
        <Compile Include="Shared\**\*.cs"/>
        <Compile Include="Properties\AssemblyInfo.cs"/>
    </ItemGroup>

    <!-- ANDROID -->
    <ItemGroup Condition=" '$(IsCompilingForAndroid)' == 'true' ">
        <Compile Include="Droid\*.cs"/>
        <Compile Include="Droid\**\*.cs"/>

        <Reference Condition=" '$(IsCompilingForClassicXamarinAndroid)' == 'true' " Include="Mono.Android"/>
    </ItemGroup>

    <!-- iOS -->
    <ItemGroup Condition=" '$(IsCompilingForClassicXamarinIOS)' == 'true' ">
        <Compile Include="iOS\**\*.cs"/>
    </ItemGroup>

    <!-- NETSTANDARD -->
    <ItemGroup Condition=" '$(IsCompilingForNetStandard)' == 'true' ">
        <Compile Include="NetStandard\**\*.cs"/>
    </ItemGroup>

    <PropertyGroup Condition=" '$(Configuration)' == 'Debug' ">
        <AndroidLinkMode>Full</AndroidLinkMode>
        <AndroidSupportedAbis>armeabi-v7a;arm64-v8a</AndroidSupportedAbis>
    </PropertyGroup>

    <PropertyGroup Condition=" '$(Configuration)' == 'Release' ">
        <AndroidLinkMode>Full</AndroidLinkMode>
        <AndroidSupportedAbis>armeabi-v7a;arm64-v8a</AndroidSupportedAbis>
    </PropertyGroup>

    <ItemGroup Condition=" '$(IsCompilingForNet6)' == 'true' ">
        <PackageReference Include="Microsoft.NET.Runtime.MonoTargets.Sdk" Version="7.0.11"/>
    </ItemGroup>

    <!-- ANDROID -->
    <ItemGroup Condition=" '$(IsCompilingForClassicXamarinAndroid)' == 'true' ">
        <PackageReference Include="Xamarin.AndroidX.Annotation" Version="1.4.0"/>
        <PackageReference Include="Laerdal.McuMgr.Bindings.Android" Version="1.0.736.0"/>
    </ItemGroup>
    <ItemGroup Condition=" '$(IsCompilingForNetXAndroid)' == 'true' ">
        <PackageReference Include="Laerdal.McuMgr.Bindings.Android.NetSix" Version="1.0.736.0"/>
    </ItemGroup>

    <!-- IOS -->
    <ItemGroup Condition=" '$(IsCompilingForClassicXamarinIOS)' == 'true' ">
        <PackageReference Include="Laerdal.McuMgr.Bindings.iOS" Version="1.0.736.0"/>
    </ItemGroup>
    <ItemGroup Condition=" '$(IsCompilingForNet6IOS)' == 'true' ">
        <PackageReference Include="Laerdal.McuMgr.Bindings.iOS.NetSix" Version="1.0.736.0"/>
    </ItemGroup>

    <!-- NETSTANDARD -->
    <ItemGroup Condition=" '$(IsCompilingForNetStandard)' == 'true' ">
        <PackageReference Include="Laerdal.McuMgr.Bindings.NetStandard" Version="1.0.736.0"/>
    </ItemGroup>

</Project>
